<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fibra Pura Mix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilo base para el texto Inter */
        html { font-family: 'Inter', sans-serif; }
        /* Estilos para la tabla en móvil */
        @media (max-width: 640px) {
            .table-container {
                overflow-x: auto;
            }
            .fiber-table th, .fiber-table td {
                padding: 0.5rem;
                font-size: 0.875rem; /* Pequeño en móvil */
            }
        }
        /* Clase para resaltar la fila de referencia */
        .highlight-row {
            background-color: #fee2e2 !important; /* Rojo claro */
            font-weight: bold;
            color: #b91c1c !important; 
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.4); 
        }
        /* Estilo para el botón flotante */
        #scrollButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            cursor: pointer;
            transition: opacity 0.3s, transform 0.3s;
        }
        /* Líneas divisorias más marcadas */
        .fiber-table tbody tr {
            background-color: #ffffff; 
            border-bottom: 2px solid #e5e7eb; 
        }
        .fiber-table tbody tr:last-child {
            border-bottom: none; 
        }
    </style>
    <script>
        // Rango administrativo modificado a 1001-1516
        const ADMIN_START = 1001;
        const ADMIN_END = 1516; // Nuevo límite superior

        // Claves para guardar en localStorage
        const STORAGE_KEY_ADMIN = 'fiberMixAdmin';
        const STORAGE_KEY_FIBER = 'fiberMixFiber';

        /**
         * Inicializa los campos de entrada cargando los últimos valores guardados.
         */
        function loadLastValues() {
            const lastAdmin = localStorage.getItem(STORAGE_KEY_ADMIN);
            const lastFiber = localStorage.getItem(STORAGE_KEY_FIBER);
            
            if (lastAdmin) {
                document.getElementById('inputAdmin').value = lastAdmin;
            }
            if (lastFiber) {
                document.getElementById('inputFibra').value = lastFiber;
            }
        }

        /**
         * Desplaza la página hasta la parte superior (al div principal).
         */
        function scrollToTop() {
            document.querySelector('.max-w-4xl').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }

        /**
         * Maneja la visibilidad del botón de subir.
         */
        function handleScrollButton() {
            const scrollButton = document.getElementById('scrollButton');
            // Muestra el botón solo si el desplazamiento vertical es mayor a 200px
            if (window.scrollY > 200) {
                scrollButton.classList.remove('opacity-0', 'scale-0');
                scrollButton.classList.add('opacity-100', 'scale-100');
            } else {
                scrollButton.classList.remove('opacity-100', 'scale-100');
                scrollButton.classList.add('opacity-0', 'scale-0');
            }
        }

        /**
         * Limpia los inputs, el localStorage, oculta la tabla y borra mensajes.
         * Importante: No se usa .focus() para evitar que se abra el teclado móvil.
         */
        function resetCalculator() {
            // 1. Limpia los campos de entrada
            document.getElementById('inputAdmin').value = '';
            document.getElementById('inputFibra').value = '';
            
            // 2. Limpia la memoria local (localStorage)
            localStorage.removeItem(STORAGE_KEY_ADMIN);
            localStorage.removeItem(STORAGE_KEY_FIBER);

            // 3. Limpia la vista (tabla y mensajes)
            document.getElementById('fiberTableBody').innerHTML = '';
            document.getElementById('tableContainer').classList.add('hidden');
            document.getElementById('messageBox').classList.add('hidden');

            // 4. Mueve la vista a la parte superior
            scrollToTop();
        }

        /**
         * Realiza el cálculo del desplazamiento, rellena la tabla con las fibras relevantes
         * y muestra solo el segmento del cable actual.
         */
        function calculateAndFill() {
            const adminInput = document.getElementById('inputAdmin');
            const fiberInput = document.getElementById('inputFibra');
            const messageBox = document.getElementById('messageBox');
            const tableContainer = document.getElementById('tableContainer');
            const tbody = document.getElementById('fiberTableBody');

            // --- CERRAR TECLADO (Clave para móviles) ---
            adminInput.blur();
            fiberInput.blur();
            // --- FIN CERRAR TECLADO ---

            // Limpiar mensaje previo y quitar cualquier resaltado anterior
            messageBox.textContent = '';
            messageBox.classList.add('hidden');
            tbody.innerHTML = ''; // Limpiamos las filas anteriores
            tableContainer.classList.add('hidden'); // Ocultamos la tabla de nuevo hasta tener resultados
            
            // Eliminar resaltado de todas las filas antes de recalcular
            document.querySelectorAll('#fiberTableBody tr').forEach(row => {
                row.classList.remove('highlight-row');
            });


            const adminValue = parseInt(adminInput.value);
            const fiberValue = parseInt(fiberInput.value);

            // --- 1. Validación de Entradas ---
            if (isNaN(adminValue) || isNaN(fiberValue) || adminValue < ADMIN_START || adminValue > ADMIN_END || fiberValue < 1) {
                messageBox.textContent = `Error: Por favor, ingrese números válidos. El Administrativo debe estar entre ${ADMIN_START} y ${ADMIN_END}, y la Fibra debe ser 1 o superior.`;
                messageBox.classList.remove('hidden');
                messageBox.classList.remove('bg-green-100', 'text-green-800');
                messageBox.classList.add('bg-red-100', 'text-red-800');
                return;
            }
            
            // --- Guardar valores en localStorage al calcular con éxito ---
            localStorage.setItem(STORAGE_KEY_ADMIN, adminValue);
            localStorage.setItem(STORAGE_KEY_FIBER, fiberValue);


            // Reestablecer estilo de éxito
            messageBox.classList.remove('bg-red-100', 'text-red-800');
            messageBox.classList.add('bg-green-100', 'text-green-800');

            // --- 2. Cálculo del Desplazamiento (Offset) ---
            // Offset = Admin Conocido - Fibra Conocida
            const offset = adminValue - fiberValue; 
            
            // --- 3. Generar Filas y Filtrar (Solo N_física >= 1) ---
            let htmlContent = '';
            let fibersMappedCount = 0;
            let firstFiberAdmin = null;
            let lastFiberAdmin = null;

            for (let adminId = ADMIN_START; adminId <= ADMIN_END; adminId++) {
                // Cálculo: N_física = N_admin - Offset
                const physicalFiberId = adminId - offset;
                
                // Aplicar el filtro: solo mostrar si es una fibra física válida (1 o más)
                if (physicalFiberId >= 1) {
                    if (firstFiberAdmin === null) {
                        firstFiberAdmin = adminId;
                    }
                    lastFiberAdmin = adminId;
                    fibersMappedCount++;

                    // Determinar si es la fila de referencia para el resaltado
                    const highlightClass = (adminId === adminValue) ? 'highlight-row' : 'hover:bg-gray-100';

                    htmlContent += `
                        <tr id="row-${adminId}" class="${highlightClass}">
                            <td class="text-center font-semibold text-gray-700 py-2 px-4">${adminId}</td>
                            <td id="fibra-${adminId}" class="text-center font-bold text-green-700 py-2 px-4">${physicalFiberId}</td>
                        </tr>
                    `;
                }
            }
            
            // Si se mapeó contenido, lo insertamos y mostramos la tabla
            if (fibersMappedCount > 0) {
                tbody.innerHTML = htmlContent;
                tableContainer.classList.remove('hidden'); // Mostrar tabla
                
                // --- 4. Desplazamiento y Resaltado ---
                const targetRow = document.getElementById(`row-${adminValue}`);
                if (targetRow) {
                    // Desplazar la vista hasta la fila central
                    targetRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }

                // Mensaje simplificado
                messageBox.textContent = '¡CÁLCULO REALIZADO!';
                messageBox.classList.remove('hidden');
            } else {
                 messageBox.textContent = 'Error: El Administrativo y Fibra ingresados resultan en un rango de fibras físicas fuera del rango Administrativo (1001-1516). Verifique sus datos.';
                messageBox.classList.remove('hidden');
                messageBox.classList.remove('bg-green-100', 'text-green-800');
                messageBox.classList.add('bg-red-100', 'text-red-800');
            }
        }

        window.onload = () => {
            // Cargar los últimos valores guardados al iniciar
            loadLastValues();

            // Asignar los eventos
            document.getElementById('calculateButton').addEventListener('click', calculateAndFill);
            document.getElementById('resetButton').addEventListener('click', resetCalculator); // Evento de limpiar
            
            // Opcional: Permitir calcular al presionar Enter en los inputs
            document.getElementById('inputFibra').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    calculateAndFill();
                }
            });
            document.getElementById('inputAdmin').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    calculateAndFill();
                }
            });

            // Inicializar el manejador del botón de desplazamiento
            document.getElementById('scrollButton').addEventListener('click', scrollToTop);
            window.addEventListener('scroll', handleScrollButton);
            // Ejecutar una vez al cargar para ocultar si es necesario
            handleScrollButton();
        };
    </script>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8">

    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl p-6 md:p-8">
        <!-- Título principal con color elegante (Teal/Emerald) -->
        <h1 class="text-3xl font-extrabold text-teal-800 mb-2">Fibra Pura Mix</h1>
        
        <!-- Descripción de la herramienta -->
        <p class="text-gray-500 italic mb-4 text-sm">(Ingresa el Administrativo y su Fibra correspondiente para mapear el segmento del cable)</p>

        <!-- Controles de Entrada: Fondo Menta Suave, Sombra profunda y Borde -->
        <div class="bg-teal-50 p-5 rounded-xl mb-6 shadow-xl border border-teal-200 flex flex-col md:flex-row gap-4 items-end">
            
            <div class="flex-1 w-full flex flex-col gap-4">
                
                <div class="w-full">
                    <!-- Etiquetas de color más oscuro y vibrante (Teal) -->
                    <label for="inputAdmin" class="block text-sm font-medium text-teal-800 mb-1">
                        Administrativo
                    </label>
                    <!-- Foco del input con color vivo (Amber) -->
                    <input type="number" id="inputAdmin" placeholder="1001-1516" min="1001" max="1516" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 transition duration-150">
                </div>

                <div class="w-full">
                    <label for="inputFibra" class="block text-sm font-medium text-teal-800 mb-1">
                        Fibra
                    </label>
                    <!-- Foco del input con color vivo (Amber) -->
                    <input type="number" id="inputFibra" placeholder="1-516" min="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 transition duration-150">
                </div>

            </div>
            
            <!-- Contenedor para botones (Columna separada en escritorio, o al lado de los inputs) -->
            <div class="flex flex-col gap-3 w-full md:w-40">
                <!-- Botón de Calcular (Acción principal, color Amber) -->
                <button id="calculateButton" class="px-6 py-3 bg-amber-600 text-white font-bold rounded-lg shadow-md hover:bg-amber-700 transition duration-300 transform hover:scale-[1.02] active:scale-[0.98] w-full">
                    Calcular
                </button>
                
                <!-- Botón de Limpiar (Acción secundaria, color neutro) -->
                <button id="resetButton" class="px-6 py-3 bg-zinc-300 text-zinc-700 font-bold rounded-lg shadow-md hover:bg-zinc-400 transition duration-300 transform hover:scale-[1.02] active:scale-[0.98] w-full">
                    Limpiar
                </button>
            </div>
        </div>

        <!-- Caja de Mensajes (manteniendo el verde para OK/rojo para Error) -->
        <div id="messageBox" class="hidden p-3 bg-green-100 text-green-800 border border-green-300 rounded-lg font-medium mb-6 transition duration-300">
            <!-- Mensajes de éxito o error se mostrarán aquí -->
        </div>

        <!-- Contenedor de la Tabla (Inicialmente oculto) -->
        <div id="tableContainer" class="hidden table-container shadow-lg rounded-xl overflow-hidden border border-gray-200">
            <table class="fiber-table w-full divide-y divide-gray-200">
                <!-- Encabezado de la tabla (Color profesional oscuro y vibrante - Teal) -->
                <thead class="bg-teal-800 sticky top-0 z-10">
                    <tr>
                        <th class="py-3 px-6 text-center text-xs font-bold text-white uppercase tracking-wider">
                            Administrativos
                            <span class="block text-teal-200 font-normal text-[0.65rem]">(ID del Plano)</span>
                        </th>
                        <th class="py-3 px-6 text-center text-xs font-bold text-white uppercase tracking-wider">
                            Fibras
                            <span class="block text-teal-200 font-normal text-[0.65rem]">(Física del cable)</span>
                        </th>
                    </tr>
                </thead>
                <tbody id="fiberTableBody" class="bg-white divide-y divide-gray-100">
                    <!-- Filas generadas dinámicamente -->
                </tbody>
            </table>
        </div>
        
        <!-- Botón Flotante para Subir (Color de acento vivo - Amber/Naranja) -->
        <button id="scrollButton" onclick="scrollToTop()" class="w-12 h-12 bg-amber-600 text-white rounded-full shadow-lg flex items-center justify-center transform transition-all duration-300 opacity-0 scale-0 hover:bg-amber-700 hover:scale-[1.1]">
            <!-- Icono de flecha hacia arriba (inline SVG) -->
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
            </svg>
        </button>

    </div>

</body>
</html>

